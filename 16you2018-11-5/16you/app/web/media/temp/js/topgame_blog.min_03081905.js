/*!  built on 2018-03-08 */
GamePack={config:{},showInfo:function(a){if("object"==typeof a){$("#pack-info-dialog").size()&&$("#pack-info-dialog").remove();var b='<div class="popup_bg" id="pack-info-dialog"><div class="receive_success" style=" margin-top: -202px;"><div class="get_img"><img src="/static/images/get_img.png" /></div><em class="close"><img src="/static/images/close_gray.png" /></em><div class="novice_bag"><h5>'+a.name+'</h5><div class="novice_bag_detail">礼包内容：'+(a.content?a.content:"暂无")+'</div><div class="novice_bag_rule">兑换码每个服可用一次，明日可再次领取</div></div><div class="novice_bag_num"><div class="active_num"><p>'+a.packCode+'</p></div><h2><img src="/static/images/up_icon.png">长按上方复制激活码</h2><div class="levitate_tip '+(this.config.isPlayView?"in-play-view":"in-other-view")+'" data-game="'+a.gameCode+'" data-desktop="'+a.isDesktop+'" data-packcode="'+a.packCode+'"><a>悬浮提示</a></div></div><div class="receive_btn '+(this.config.game?"start-game":"confirm-btn")+'" '+(this.config.game?'data-game="'+a.gameCode+'"':"")+' data-desktop="'+a.isDesktop+'"><a>'+(this.config.game?"开始游戏":"确定")+"</a></div></div></div>";$.popupAppend(b),$.popupRotate($("#pack-info-dialog")),$("#pack-info-dialog").show(),$("#pack-info-dialog").on("click",".close,.confirm-btn",function(){$("#pack-info-dialog").remove()}),$("#pack-info-dialog").on("click",".levitate_tip",function(){$(".levitate_tip").hasClass("in-other-view")&&(2==$(this).data("desktop")&&TPGAME_CONF.isInPC?$.showNoticeMsg("此游戏暂时不支持PC端"):$.openUrlInWebView({url:"/game/play/"+($(this).data("game")||TPGAME_CONF.game.code)+"?packCode="+a.packCode}))})}},showNoCodePack:function(a){if("object"==typeof a){$("#no-code-pack-info-dialog").size()&&$("#no-code-pack-info-dialog").remove();var b;b=TPGAME_CONF.isWeixin?'<div class="get_img"><img src="/static/images/img_v2/ewm.png"/></div><h2>长按扫描公众号</h2>':TPGAME_CONF.isInPC?'<div class="get_img"><img src="/static/images/img_v2/ewm.png"/></div><h2>扫描公众号</h2>':'<div class="active_num"><p>金榜游戏</p></div><h2><img src="/static/images/up_icon.png">长按复制公众号名称</h2>';var c='<div class="popup_bg" id="no-code-pack-info-dialog"><div class="receive_success" style="margin-top:-208px; width:300px; margin-left:-150px"><div class="get_img"><img src="/static/images/get_img.png" /></div><em class="close"><img src="/static/images/close_gray.png" /></em><div class="novice_bag"><h5>'+a.name+'</h5><div class="novice_bag_detail">礼包内容：'+(a.content?a.content:"暂无")+'</div><div class="novice_bag_rule">关注游戏金榜公众号回复游戏名称领取礼包</div></div><div class="novice_bag_num">'+b+'</div><div class="receive_btn '+(this.config.game?" start-game":"confirm-btn")+'" '+(this.config.game?'data-game="'+a.gameCode+'"':"")+'data-desktop="'+a.isDesktop+'"><a>'+(this.config.game?"开始游戏":"确定")+"</a></div></div></div>";$.popupAppend(c),$.popupRotate($("#no-code-pack-info-dialog")),$("#no-code-pack-info-dialog").show(),$("#no-code-pack-info-dialog").on("click",".close,.confirm-btn",function(){$("#no-code-pack-info-dialog").remove()})}},showNoPack:function(){$("#no-pack-dialog").size()&&$("#no-pack-dialog").remove();var a='<div id="no-pack-dialog" class="popup_bg" style="display: none;"><div class="receive_success" style=" margin-top: -140px;"><div class="fail_img"><img src="/static/images/fail_pic.png" /></div><em class="close"><img src="/static/images/close_gray.png" /></em><div class="fail_text">很遗憾，您来晚了~ <br/>礼包已经被抢光啦！</div><div class="receive_btn"><a>我知道了</a></div></div></div>';$.popupAppend(a),$.popupRotate($("#no-pack-dialog")),$("#no-pack-dialog").show(),$("#no-pack-dialog").on("click",".close,.receive_btn",function(){$("#no-pack-dialog").remove()})},receivePack:function(a){var b=this;b.receiveNoCodePack(a),b.config=a||{},$("#game-pack-container").on("click",".receive-now",function(){if($.trackEvent("小白点领取礼包"),TPGAME_CONF.isLogin){var a=$(this),c=a.data("pack");$.showLoading(),$.ajax({url:"/game/api/gamepack.json",type:"post",dataType:"json",data:{game_code:a.data("game")||TPGAME_CONF.game.code,game_pack_id:c},success:function(d){if($.hideLoading(),5==d.code)TPGAME_CONF.isMobile||TPGAME_CONF.isInAppView?($("#diy-login-tips").text("领取礼包前请先登录"),Login.commonLoginDialog()):$.openUrlInWebView({url:"/account/auth.html?redirect_uri="+TPGAME_CONF.redirect_uri});else if(0!=d.code)TPGAME_CONF.activePack?$("#no-pack-dialog").show():b.showNoPack();else{if(TPGAME_CONF.activePack)$("#pack-info-code").text(d.pack_code),$("#pack-info-copy").attr("data-clipboard-text",d.pack_code),$("#pack-info-dialog").show();else{var e={name:d.name,packId:c,packCode:d.pack_code,expireTime:d.expire_time,content:d.content,detail:d.detail,gameCode:a.data("game")||TPGAME_CONF.game.code,gameName:a.data("gamename")||"",gameIcon:a.data("gameicon")||"",isDesktop:TPGAME_CONF.isDesktop||a.data("desktop"),isViewPack:!1};b.showInfo(e),a.replaceWith('<div class="receive has-received" data-game="'+e.gameCode+'" data-desktop="'+e.isDesktop+'" data-name="'+d.name+'" data-packId="'+c+'" data-content="'+(d.content?d.content.replace(/"/g,"'"):"")+'" data-detail="'+(d.detail?d.detail.replace(/"/g,"'"):"")+'" data-code="'+d.pack_code+'" data-expiretime="'+d.expire_time+'"><a>查看</a></div>')}"礼包"==$("#game_menu_box .icon_mean em").text()&&($(".receive-now").size()||$(".receive-no-code-now").size()||$("#game_menu_box .icon_mean").find("em").remove()),"function"==typeof b.config.callback&&b.config.callback(e)}},error:function(){$.hideLoading(),alert("网络不给力，请稍后重试")}})}else TPGAME_CONF.isMobile||TPGAME_CONF.isInAppView?($("#diy-login-tips").text("领取礼包前请先登录"),Login.commonLoginDialog()):$.openUrlInWebView({url:"/account/auth.html?redirect_uri="+TPGAME_CONF.redirect_uri})}).on("click",".shop-pack",function(){$.openUrlInWebView({url:"/game/shop_pack.html?packId="+$(this).data("id")})}),b.viewPack()},receiveNoCodePack:function(a){var b=this;$("#game-pack-container").on("click",".receive-no-code-now",function(){if($.trackEvent("小白点领取礼包"),TPGAME_CONF.isLogin){var a=$(this),c=a.data("pack");$.showLoading(),$.ajax({url:"/game/api/nocodepack.json",type:"post",dataType:"json",data:{game_code:a.data("game")||TPGAME_CONF.game.code,game_pack_id:c},success:function(c){if($.hideLoading(),5==c.code)$("#diy-login-tips").text("领取礼包前请先登录"),Login.commonLoginDialog();else if(0!=c.code)b.showNoPack();else{var d={name:c.name,packCode:c.pack_code,expireTime:c.expire_time,content:c.content,detail:c.detail,gameCode:a.data("game")||TPGAME_CONF.game.code,gameName:a.data("gamename")||"",gameIcon:a.data("gameicon")||"",qq:TPGAME_CONF.qq,isDesktop:TPGAME_CONF.isDesktop||a.data("desktop"),isViewPack:!1};b.showNoCodePack(d),a.replaceWith('<div class="receive has-no-code-received" data-name="'+c.name+'" data-content="'+(c.content?c.content.replace(/"/g,"'"):"")+'" data-detail="'+(c.detail?c.detail.replace(/"/g,"'"):"")+'" data-expiretime="'+c.expire_time+'"><a>查看</a></div>'),"礼包"==$("#game_menu_box .icon_mean em").text()&&($(".receive-now").size()||$(".receive-no-code-now").size()||$("#game_menu_box .icon_mean").find("em").remove()),"function"==typeof b.config.noCodeCallback&&b.config.noCodeCallback(d)}},error:function(){$.hideLoading(),alert("网络不给力，请稍后重试")}})}else TPGAME_CONF.isMobile?($("#diy-login-tips").text("领取礼包前请先登录"),Login.commonLoginDialog()):$.openUrlInWebView({url:"/account/auth.html?redirect_uri="+TPGAME_CONF.redirect_uri})}),b.viewNoCodePack()},viewNoCodePack:function(){var a=this;$("#game-pack-container").on("click",".has-no-code-received",function(){var b=$(this);a.showNoCodePack({name:b.data("name"),expireTime:b.data("expiretime"),content:b.data("content"),detail:b.data("detail"),gameCode:b.data("game")||TPGAME_CONF.game.code,qq:TPGAME_CONF.qq,isDesktop:TPGAME_CONF.isDesktop||b.data("desktop"),isViewPack:!0})})},viewPack:function(){var a=this;$("#game-pack-container").on("click",".has-received",function(){var b=$(this);a.showInfo({name:b.data("name"),packCode:b.data("code"),expireTime:b.data("expiretime"),content:b.data("content"),detail:b.data("detail"),gameCode:b.data("game")||TPGAME_CONF.game.code,isDesktop:TPGAME_CONF.isDesktop||b.data("desktop"),isViewPack:!0})})},myPack:function(){$("#has-new-pack").on("click",function(){$.setClientInfo("firstNewPackDate",(new Date).getTime(),2073600),$.openUrlInWebView({url:"/game/packlist.html"}),TPGAME_CONF.isInAppView&&window.MiJSBridge&&MiJSBridge.call("closeOthers")}),this.receivePack({game:1})},qrPack:function(){$("#begin_game").on("click",function(){$.openUrlInWebView({url:"/game/play/"+$("#begin_game").data("code")})})},packList:function(){var a=this;$(".no_result").size()&&$("body").css("background","#fff"),$(".more-package-button").on("click",function(){var a=$(this),b=a.data("gameid");$.showLoading(),$.ajax({url:"/game/api/packList.json",type:"POST",data:{gameid:b},dataType:"json",success:function(b){var c=Handlebars.compile($("#pack-list-template").html());a.after(c(b)),a.remove(),$.hideLoading()},error:function(){$.hideLoading(),$.showErrorMsg("请稍后重试")}})}),a.receivePack({game:1}),GamePack.packSearch()},packSearch:function(){var a=0;$(".back_home").click(function(){$.back("/game/packlist.html")}),$(".cancel").click(function(){$(this).hide(),$("#search-input").val("").focus()}),$("#search-input").bind("input propertychange",function(){"/game/packlist.html"==location.pathname?$(this).val().length>0?$(".cancel").show():$(".cancel").hide():$(this).val().length>0?($(".search_text").removeClass("dn"),$(".back_home").addClass("dn"),$(".cancel").show()):($(".back_home").removeClass("dn"),$(".search_text").addClass("dn"),$(".cancel").hide())}).focus(function(){"/game/packlist.html"==location.pathname?$(this).val().length>0?$(".cancel").show():$(".cancel").hide():$(this).val().length>0?($(".search_text").removeClass("dn"),$(".back_home").addClass("dn"),$(".cancel").show()):($(".back_home").removeClass("dn"),$(".search_text").addClass("dn"),$(".cancel").hide())}),$(".search_text").click(function(){$("#search-input").blur();var b=$("#search-input").val(),c=(new Date).getTime();if(""!=b&&c-a>2e3){a=c;var d="/game/pack_search.html?keyword="+encodeURIComponent(b);"/game/packlist.html"==location.pathname?$.openUrlInWebView({url:d}):$.openUrl(d)}})},activePack:function(){function a(){$("#share-dialog").hide(),TPGAME_CONF.receiveSharePack=1,TPGAME_CONF.isLogin&&$.ajax({url:"/game/api/gamepack.json",type:"post",dataType:"json",data:{game_code:TPGAME_CONF.game.code,game_pack_id:TPGAME_CONF.sharePack},success:function(a){$.hideLoading(),0==a.code?($("#pack-info-code").text(a.pack_code),$("#pack-info-copy").attr("data-clipboard-text",a.pack_code),$("#pack-info-dialog").show()):5==a.code?$("#login-dialog").show():$("#no-pack-dialog").show()},error:function(){$.hideLoading(),alert("网络不给力，请稍后重试")}})}GamePack.receivePack({game:1}),"undefined"!=typeof wx&&wx.ready(function(){wx.hideMenuItems({menuList:["menuItem:share:timeline"]}),wx.onMenuShareTimeline({title:TPGAME_CONF.game.shareTitle,link:TPGAME_CONF.game.shareUrl,imgUrl:TPGAME_CONF.game.icon,success:function(){$.shareSuccess(a())}}),wx.onMenuShareAppMessage({title:TPGAME_CONF.game.shareTitle,link:TPGAME_CONF.game.shareUrl,imgUrl:TPGAME_CONF.game.icon,desc:TPGAME_CONF.game.shareDesc,success:function(){$.shareSuccess(a())}})}),$(".share-pack").on("click",function(){TPGAME_CONF.isInAppView&&window.MiJSBridge?MiJSBridge.call("share",{title:TPGAME_CONF.game.shareTitle,content:TPGAME_CONF.game.shareDesc,image:TPGAME_CONF.game.icon,url:TPGAME_CONF.game.shareUrl},function(b){var c="string"==typeof b?$.parseJSON(b):b;0==c.state&&$.shareSuccess(a())}):0==TPGAME_CONF.receiveSharePack?$("#share-dialog").show():a()}),$("#share-dialog").on("click",function(){$("#share-dialog").hide()}),$("#pack-info-close, #no-pack-close, .close").on("click",function(){$(this).closest(".popup_bg").hide()}),$("#pack-info-copy").click(function(){var a=new Clipboard("#pack-info-copy");a.on("success",function(){$.showMsg("复制成功")})})},gameLottery:function(){$(".dial_box").height($(".dial_box .dial").width());var a=!0;$("#game-lottery-btn").click(function(){TPGAME_CONF.isLogin?a&&(a=!1,$.ajax({url:"/game/api/lottery_game.json",type:"post",dataType:"json",data:{game_code:TPGAME_CONF.game.code},success:function(b){if(0==b.code){var c=240;1==b.lottery_callback?c=240:2==b.lottery_callback?c=180:3==b.lottery_callback&&(c=60),$(".dial_light_bg").rotate({angle:0,animateTo:1800+c,duration:3e3,callback:function(){a=!0,$("#game-lottery-content").html('<p class="txt_c">恭喜您抽中 '+b.name+'</p><p class="txt_c"> '+b.pack_code+"</p>").closest(".popup_bg").show()}})}else b.code==-2?(a=!0,$("#game-lottery-content").html('<p class="txt_c">您今天已经参与过活动了，</p><p class="txt_c">请明天再来哦</p>').closest(".popup_bg").show()):b.code==-3?(a=!0,$("#game-lottery-content").html('<p class="txt_c mt20">谢谢参与</p>').closest(".popup_bg").show()):b.code==-4?(a=!0,$("#game-lottery-content").html('<p class="txt_c mt20">活动已经结束了，感谢您的参与</p>').closest(".popup_bg").show()):(a=!0,$("#game-lottery-content").html('<p class="txt_c mt20">'+b.message+"</p>").closest(".popup_bg").show())}})):TPGAME_CONF.isMobile||TPGAME_CONF.isInAppView?Login.commonLoginDialog():$.openUrlInWebView({url:"/account/auth.html?redirect_uri="+TPGAME_CONF.redirect_uri})}),$(".popup_bg .close").on("click",function(){$(this).parents(".popup_bg").hide()}),$(".btn_box .angle_rule_btn").click(function(){$("#game-active-rule").show()}),$(".btn_box .angle_begin_btn").click(function(){$.openUrlInWebView({url:"/game/play/dtszj"})}),$(".btn_box .angle_prize_btn").click(function(){$.ajax({url:"/game/api/game_lottery_prize.json",type:"POST",data:{gameId:TPGAME_CONF.game.id},dataType:"json",success:function(a){var b=Handlebars.compile($("#game-lottery-prize-list").html());$("#game-lottery-prize .record_list tbody").html(b(a)),$("#game-lottery-prize").show()}})})}},Login={config:{isInitLoginDialogEvent:!1},shopOrUserLoginDialog:function(){$("#login-dialog").show(),this.loginDialogEvent(),$("body").on("touchmove",function(a){a.preventDefault()},!1)},appGameListDialog:function(){var a=this;!TPGAME_CONF.isInAppView||TPGAME_CONF.isLogin||$.getClientInfo("appGameListLogin")||($("#app-login-dialog").show(),$.setClientInfo("appGameListLogin","1",Constant.secondsOfYear),a.loginDialogEvent()),$("#app-login-dialog .close_yuan").on("click",function(){return $("#app-login-dialog").hide(),!1}),$("#download-app-dialog .close_b").on("click",function(){$("#download-app-dialog").hide()}),$("#go-to-download-app").on("click",function(){$.downApp(TPGAME_CONF.deviceType)}),TPGAME_CONF.isInAppView&&TPGAME_CONF.isLogin&&!$.getClientInfo("firstInAppLoginSuccess")&&($.setClientInfo("firstInAppLoginSuccess","1",Constant.secondsOfYear),this.awardUser())},awardUser:function(){$("#app-hongbao-dialog .close_yuan").on("click",function(){$("#app-hongbao-dialog").hide()}),$("#app-hongbao-dialog .hongbao_btn").on("click",function(){location.href.indexOf("my.html")!=-1?$("#app-hongbao-dialog").hide():$.openUrl("/user/my.html")}),$.ajax({url:"/game/api/award.json",type:"post",dataType:"json",success:function(a){0==a.code&&($("#user-account").size()>0&&$("#user-account i").text(a.balance),$("#app-hongbao-dialog").show())},error:function(){}})},mlogin:function(){this.loginDialogEvent(),$("#m-login-close").on("click",function(){"yd"==TPGAME_CONF.channelType?$.openUrlInWebView({url:"/game/yd/list.html"}):$.openUrlInWebView({url:"/game/list.html"})})},commonLoginDialog:function(){$("#diy-login-dialog").size()?$("#diy-login-dialog").show():$("#login-dialog").show(),this.config.isInitLoginDialogEvent||this.loginDialogEvent()},diyLoginDialog:function(){var a=$.cookie("c_index");if("wxly"==a){var b=encodeURIComponent("https://wx.99kgames.com/game/platform/"+a+".html");0==window.location.pathname.indexOf("/game/play/")&&(b=encodeURIComponent("https://wx.99kgames.com/game/platform/"+a+".html?redirect=/game/play/"+TPGAME_CONF.game.code)),window.location.href="http://www.lygdcm.cn/wxly/wxly_game_login/login.html?gameAddress="+b}},qrcodeTimer:null,verifyTimer:null,pcLogin:function(){function a(){$.ajax({url:"/game/api/qrcodeLogin.json",type:"POST",dataType:"json",success:function(a){$("#wechat-pclogin-dialog .kefu_ewm_pic img").attr("src",a.qrcode),clearInterval(Login.verifyTimer),Login.verifyTimer=setInterval(function(){$.ajax({url:"/game/api/verifyUser.json",type:"POST",data:{sceneId:a.sceneId},dataType:"json",success:function(a){if(0==a.code)if(clearInterval(Login.qrcodeTimer),clearInterval(Login.verifyTimer),$("#qrcode_logout",window.parent.document).show(),$("#qrcode_logout",window.parent.document).find("b").text(a.message),$("#pc-login-qr img",window.parent.document).attr("src","/static/images/img_v2/ewm.png"),TPGAME_CONF&&TPGAME_CONF.playIndex)location.reload();else{parent.window.clearLoginTimer();var b=location.pathname,c=location.search,d="/game/index.html?";2==c.split("source=").length&&(d="/game/index.html?source="+c.split("source=")[1]+"&"),window.parent.location.replace(d+"redirect_uri="+encodeURIComponent(b+c))}}})},2e3)}})}$("#qrcode_login",window.parent.document).hide(),clearInterval(Login.qrcodeTimer),a(),Login.qrcodeTimer=setInterval(a,24e4)},traditionLogin:function(){$("#pc-sign").on("click",function(){$("#login-container").hide(),$("#sign_box").removeClass("dn")}),$("#sign_box").on("click","h1 img",function(){$("#login-container").show(),$("#sign_box").addClass("dn")}).on("click",".sign_btn, .sign_btn2",function(){var a=$("#name").val(),b=$("#pass").val();return $.trim(a)&&$.trim(b)?void $.ajax({url:"/game/api/login.json",type:"POST",data:{name:a,pass:b},dataType:"json",success:function(a){0==a.code?top.location.reload():alert(a.message)},error:function(){alert("网络不给力,请稍后重试")}}):void alert("用户名或密码不能为空")}).on("click",".register_btn",function(){$("#app-register-dialog").size()?$("#app-register-dialog").show():TPGAME_CONF&&TPGAME_CONF.isInPC&&(top.location.href="/game/gw/register.html")})},mobileLogin:function(){var a=this;$("#m-mobile-login, #mobile-login-1").on("click",function(){return $("#mobile-login-dialog").show(),$("#validate-code-image img").attr("src")||$("#validate-code-image").trigger("click"),$("#mobile-input").focus(),a.notifyReReYunLogin(),!1}),Mobile.initMobileDialog()},qqAndWeiboLogin:function(){var a=this;$("#m-qq-login, #qq-login-1").on("click",function(){if($("#login-iframe-dialog").show(),TPGAME_CONF.isInPC){var b="/game/index.html?realUrl="+encodeURIComponent(TPGAME_CONF.redirect_uri);$("#login-iframe").attr("src","/account/qq.html?redirect_uri="+encodeURIComponent(b))}else $("#login-iframe").attr("src","/account/qq.html?redirect_uri="+encodeURIComponent(TPGAME_CONF.redirect_uri)),a.notifyReReYunLogin();return!1}),$("#m-weibo-login, #weibo-login-1").on("click",function(){$("#login-iframe-dialog").show();var b="/game/loginsuccess.html?realUrl="+encodeURIComponent(TPGAME_CONF.redirect_uri);return $("#login-iframe").attr("src","/account/weibo.html?redirect_uri="+encodeURIComponent(b)),a.notifyReReYunLogin(),!1}),$("#login-iframe-dialog .payframe_close").on("click",function(){$("#login-iframe").attr("src",""),$("#login-iframe-dialog").hide()})},wxLogin:function(){function a(){c<=b&&$.ajax({url:"/game/api/verifyUser.json",type:"POST",data:{sceneId:TPGAME_CONF.scene_id},dataType:"json",success:function(b){0==b.code?$.showMsg("登录成功",function(){$.openUrlInWebView({url:TPGAME_CONF.redirect_uri})}):(c++,setTimeout(a,2e3))},error:function(){console.log("error")}})}var b=300,c=1;setTimeout(a,2e3)},appLogin:function(a){var b=this,c=$(a).data("type")||1;window.MiJSBridge&&MiJSBridge.call("userLogin",{type:c},function(a){var b="string"==typeof a?$.parseJSON(a):a;0==b.state?($.cookie("tk",b.description,Constant.appLoginTkExpires),TPGAME_CONF.redirect_uri?location.replace(TPGAME_CONF.redirect_uri):location.reload()):$.showErrorMsg("登录失败,请稍后重试")}),b.notifyReReYunLogin()},notifyReReYunLogin:function(){TPGAME_CONF.isHasReYun&&window.MiJSBridge&&MiJSBridge.call("reYunLogin")},loginDialogEvent:function(){var a=this;this.config.isInitLoginDialogEvent?console.log("TPLogin init finished."):(this.config.isInitLoginDialogEvent=!0,$("#m-wechat-login, #wechat-login-1").on("click",function(){return TPGAME_CONF.isInPC?(a.pcLogin(),$("#wechat-pclogin-dialog").show()):TPGAME_CONF.isInAppView?a.appLogin(this):$.openUrlInWebView({url:"/account/wxlogin.html?redirect_uri="+encodeURIComponent(TPGAME_CONF.redirect_uri)}),!1}),$("#m-wechat-login-app").on("click",function(){return a.appLogin(this),!1}),$("#wechat-pclogin-dialog .close").on("click",function(){$("#wechat-pclogin-dialog").hide(),clearInterval(Login.qrcodeTimer),clearInterval(Login.verifyTimer)}),a.qqAndWeiboLogin(),a.mobileLogin(),a.agreementDetail(),a.traditionLogin(),$("#diy-login-1").on("click",function(){a.diyLoginDialog()}),$("#diy-login-dialog").on("click",".pop_posi_bot",function(){a.diyLoginDialog()}).on("click",".close",function(){$("#diy-login-dialog").hide()}).on("click",".receive_success",function(){return!1}).on("click",function(){$("#diy-login-dialog").hide()}),TPGAME_CONF&&TPGAME_CONF.noCloseLoginDilog?$("#close-dialog").on("click",function(){return $.safeGoBack("/game/list.html"),!1}):$("#close-dialog").on("click",function(){$("#login-dialog").hide()}))},agreementDetail:function(){$("#agreement-detail").click(function(){$("#login-agreement-dialog").find(".zixun_main > p").children().size()>1?$("#login-agreement-dialog").show():($.showLoading(),$.ajax({url:"/game/api/agreement.json",type:"POST",data:{gameId:TPGAME_CONF.game.id},dataType:"html",success:function(a){$.hideLoading(),$("#login-agreement-dialog").show().find(".zixun_main > p").html(a)},error:function(){$.hideLoading(),$.showMsg("内容加载异常")}}))}),$("#login-agreement-dialog").on("click",".close",function(){$("#login-agreement-dialog").hide()})},syncUser:function(){$.showLoading(),$.ajax({url:"/game/api/user.json",type:"POST",data:{openid:TPGAME_CONF.openid,type:TPGAME_CONF.type},dataType:"json",success:function(a){if($.hideLoading(),0==a.code)$.openUrlInWebView({url:TPGAME_CONF.redirect_uri});else if(a.code==-1){var b=10==TPGAME_CONF.type?"/account/weibo.html?redirect_uri="+TPGAME_CONF.redirect_uri:"/account/qq.html?redirect_uri="+TPGAME_CONF.redirect_uri;$.openUrlInWebView({url:b})}else $.showMsg("请稍后重试")},error:function(){$.hideLoading(),$.showMsg("请稍后重试")}}),$("#sync").on("click",function(){})},relationUser:function(){function a(){c<=b&&$.ajax({url:"/game/api/relation.json",type:"POST",data:{openid:TPGAME_CONF.openid,type:TPGAME_CONF.type},dataType:"json",success:function(b){0==b.code?$.showMsg("同步成功",function(){$.openUrlInWebView({url:TPGAME_CONF.redirect_uri})}):(c++,setTimeout(a,2e3))},error:function(){console.log("同步出错")}})}var b=300,c=1;setTimeout(a,2e3),$("#wx-image").on("click",function(){console.log("src = "+$("#wx-image")[0].src),window.MiJSBridge&&MiJSBridge.call("saveImage",{image:$("#wx-image")[0].src},function(a){console.log(a)})})}},Mobile={tips:"获取语音验证码",initMobileDialog:function(){$("#mobile-login-dialog").on("click","#get-verifycode",function(){Mobile.sendCode(this,$("#mobile-input").val())}).on("click","#login",function(){Mobile.verifyCode({url:TPGAME_CONF.redirect_uri,loginUrl:"/auth/api/mobile.json"})}).on("click",".close",function(){$("#mobile-login-dialog").hide()}).on("click","#validate-code-image",function(){$("#validate-code-image img").prop("src","/game/api/imageCode?"+Math.random())}).on("click","#code-clear",function(){$("#image-code").val("")})},bindMobileDialog:function(){function a(a){var b=$.getClientInfo("game_list_bind_mobile")||"",c=parseInt($.getClientInfo("game_list_bind_mobile_num")||1);a&&!b&&c<=2&&(c+=1,$("#bind-mobile-dialog").show(),$.setClientInfo("game_list_bind_mobile","1",$.getTime())),$.setClientInfo("game_list_bind_mobile_num",c,31536e3)}$("#bind-mobile-dialog").on("click",".close",function(){a(!1),$("#bind-mobile-dialog").hide()}).on("click",".yuan_btn",function(){a(!1),$("#bind-mobile-dialog").hide(),$.openUrlInWebView({url:"/user/myaccount.html"})}),$("#bind-mobile-dialog").size()&&a(!0)},isMobile:function(a){if("19930202"==a||"19931008"==a)return!0;var b=/^1[3|4|5|8|7][0-9]\d{8}$/;return b.test(a)},sendCode:function(a,b){function c(a,b){0==f?(a.style.background="#fff",a.style.borderColor="#0084ff",a.style.color="#0084ff",a.removeAttribute("style"),a.removeAttribute("disabled"),a.innerHTML=b,f=60,$(".short_mess").removeClass("dn")):(a.style.background="#ddd",a.style.borderColor="#e1e1e1",a.style.color="#fff",a.setAttribute("disabled",!0),a.innerHTML="重新发送"+(f?"("+f+")":""),f--,$(".short_mess").addClass("dn"),e=setTimeout(function(){c(a,b)},1e3))}function d(a,b){clearTimeout(e),a.style.background="#fff",a.style.borderColor="#0084ff",a.style.color="#0084ff",a.removeAttribute("disabled"),a.innerHTML=b}var e,f=60,g=a;if(!$(g).attr("disabled")){if(b=b?b:$("#mobile-input").val(),"19930202"==b||"19931008"==b)return void $.showNoticeMsg("验证码是8765");if(!$.isMobile(b))return void $.showNoticeMsg("请输入正确的手机号");var h=1,i=$("#image-code").size?$("#image-code").val():"";0==window.location.pathname.indexOf("/user/trade/mobile_validate.html")&&(h=0),$(g).hasClass("sms-code")?$.ajax({url:"/game/api/smsCodeValidate.json",type:"POST",data:{mobile:b,imageCode:i,imageValid:h},dataType:"json",success:function(a){0==a.code?($("#image-code").next().hide(),$.showNoticeMsg("请注意查收短信")):a.code==-2?(d(g,"获取短信验证码"),$("#image-code").next().show(),$.showNoticeMsg("图片验证码不正确"),a.message.indexOf("过期")>-1&&$("#validate-code-image").trigger("click")):(d(g,"获取短信验证码"),$.showErrorMsg(a.message))},error:function(){d(g,"获取短信验证码"),$.showErrorMsg("网络出错.")}}):$.ajax({url:"/game/api/cellphoneValidate.json",type:"POST",data:{mobile:b,imageCode:i,imageValid:h},dataType:"json",success:function(a){0==a.code?($("#image-code").next().hide(),$.showNoticeMsg("请注意接听来电")):a.code==-2?(d(g,"获取语音验证码"),$("#image-code").next().show(),$.showNoticeMsg("图片验证码不正确"),a.message.indexOf("过期")>-1&&$("#validate-code-image").trigger("click")):(d(g,"获取语音验证码"),$.showErrorMsg(a.message))},error:function(){d(g,"获取语音验证码"),$.showErrorMsg("网络出错.")}}),c(g,Mobile.tips),$(".short_mess").on("click",function(){$(this).hasClass("cellphone-code")?(Mobile.tips="获取语音验证码",$("#get-verifycode").removeClass("sms-code"),$("#verify-code").attr("placeholder","请输入语音验证码")):(Mobile.tips="获取短信验证码",$("#get-verifycode").addClass("sms-code"),$("#verify-code").attr("placeholder","请输入短信验证码")),$(".short_mess").remove(),$("#get-verifycode").trigger("click")})}},sendBasicVerifyCode:function(a,b,c,d){function e(a,b){0==i?(a.removeAttribute("disabled"),a.removeAttribute("style"),a.innerHTML=b,i=60):("function"==typeof d?d():a.style.color="#999",a.setAttribute("disabled",!0),a.innerHTML="重新发送"+(i?"("+i+")":""),i--,g=setTimeout(function(){e(a,b)},1e3))}function f(a,b){clearTimeout(g),a.removeAttribute("style"),a.removeAttribute("disabled"),a.innerHTML=b}var g,h=a,i=60;return $.isMobile(b)?void(h.getAttribute("disabled")||(e(h,"获取验证码"),$.ajax({url:"/game/api/commonSmsValidate.json",type:"POST",data:{mobile:b,type:c},dataType:"json",success:function(a){0==a.code?$.showNoticeMsg("请注意查收短信"):(f(h,"获取验证码"),$.showErrorMsg(a.message))},error:function(){f(h,"获取验证码"),$.showErrorMsg("网络出错.")}}))):void $.showNoticeMsg("请输入正确的手机号")},verifyCode:function(a){if(a&&"object"==typeof a){var b=a.mobile?a.mobile:$("#mobile-input").val();return"19930202"==b||"19931008"==b||$.isMobile(b)?$("#agreement-confirm").size()&&!$("#agreement-confirm").is(":checked")?void $.showNoticeMsg("请阅读并同意《用户服务注册协议》"):void $.ajax({url:a.loginUrl?a.loginUrl:"/user/api/bindMobile.json",type:"POST",data:{mobile:b,code:$("#verify-code").val()},dataType:"json",success:function(b){"function"==typeof a.succCb?a.succCb(b):0==b.code?$.showNoticeMsg(b.message,function(){$.openUrl(a.url)}):$.showErrorMsg(b.message)},error:function(){"function"==typeof a.failCb?a.failCb():$.showErrorMsg(Constant.eerrorMsg)}}):void $.showNoticeMsg("请输入正确的手机号")}}},!function(a){function b(){window.onpageshow=null,MiJSBridge.on("onRefreshPage",c)}function c(){"function"==typeof d.onPageShowAgain?d.onPageShowAgain(event):d("body").data("refresh")&&location.reload()}a.Constant={secondsOfYear:31536e3,eerrorMsg:"网络不给力",appLoginTkExpires:2592e3,base64EncodeChars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",canShowInitDialog:!0};var d=a.$||a.jQuery;try{if(d("#main_con",window.parent.document).size()){d("#main_con",window.parent.document).removeClass("transverse_game");var e=window.parent.innerHeight;if("/game/adm/index.html"!=top.location.pathname)if(d(".wrap_box",window.parent.document).hasClass("full_screen_box")){d("#main_con",window.parent.document).css("height",e),d("#main_con",window.parent.document).css("width",e/1.68);var f=d("#main_con",window.parent.document).css("marginLeft");d("#main_con",window.parent.document).css("marginLeft",parseInt(f)-e/12)}else d("#main_con",window.parent.document).css("height",e-85),d("#main_con",window.parent.document).css("width",e/1.8);else d("#main_con",window.parent.document).css("width",e/1.8);d("#main_con",window.parent.document).css("min-height","")}}catch(g){}if(d.popupAppend=function(a){TPGAME_CONF&&TPGAME_CONF.playIndex?d(".collect_popup_box").append(a):d("body").append(a)},d.popupRotate=function(a){TPGAME_CONF&&TPGAME_CONF.playIndex&&1==TPGAME_CONF.isLand&&a.css({transform:"rotate(90deg)"})},d.fileSize=function(a){if(a.indexOf("=")>0){var b=a.indexOf("=");a=a.substring(0,b)}return parseInt(a.length-a.length/8*2)},d.base64encode=function(a){var b,c,d,e,f,g,h=Constant.base64EncodeChars;for(d=a.length,c=0,b="";c<d;){if(e=255&a.charCodeAt(c++),c==d){b+=h.charAt(e>>2),b+=h.charAt((3&e)<<4),b+="==";break}if(f=a.charCodeAt(c++),c==d){b+=h.charAt(e>>2),b+=h.charAt((3&e)<<4|(240&f)>>4),b+=h.charAt((15&f)<<2),b+="=";break}g=a.charCodeAt(c++),b+=h.charAt(e>>2),b+=h.charAt((3&e)<<4|(240&f)>>4),b+=h.charAt((15&f)<<2|(192&g)>>6),b+=h.charAt(63&g)}return b},d.isMobile=function(a){var b=/^1[3|4|5|8|7][0-9]\d{8}$/;return b.test(a)},d.cookie=function(a,b,c){if(!a){for(var d={},e=document.cookie.split(";"),f=0,g=e.length;f<g;++f){var h=e[f].trim().split("=");2==h.length&&(d[h[0]]=decodeURIComponent(h[1]))}return d}if(void 0===b){var i=document.cookie,j=a+"=",k=i.indexOf(j);if(k>=0){var l=i.indexOf(";",k);l<0&&(l=i.length),b=document.cookie.substring(k+j.length,l)}return b?decodeURIComponent(b):void 0}c=parseInt(c)||86400;var m=new Date;m.setTime(m.getTime()+1e3*c);var n="expires="+m.toUTCString();document.cookie=a+"="+encodeURIComponent(b)+"; "+n+"; path=/"},d.getTime=function(){var a=new Date,b=new Date;return b.setHours(23),b.setMinutes(59),b.setSeconds(59),b.setMilliseconds(999),parseInt((b.getTime()-a.getTime())/1e3)},d.setClientInfo=function(a,b,c){if("undefined"!=typeof a&&"undefined"!=typeof b)return d.isSupportedLocalStorage()?(localStorage[a]=b,void("undefined"!=typeof c&&parseInt(c)>0&&(localStorage[a+"_time"]=parseInt((new Date).getTime()/1e3)+c))):void d.cookie(a,b,c)},d.getClientInfo=function(a){if("undefined"!=typeof a){if(d.isSupportedLocalStorage()){var b=a+"_time",c=parseInt(localStorage[b]||0);if(c<=0)return localStorage[a];var e=parseInt((new Date).getTime()/1e3);return e<c?localStorage[a]:""}return d.cookie(a)}},d.removeClientInfo=function(a){"undefined"!=typeof a&&(d.isSupportedLocalStorage()?localStorage.removeItem(a):d.cookie(a,"",-1))},d.isSupportedLocalStorage=function(){try{return window.localStorage.setItem("k","v"),window.localStorage.removeItem("k"),!0}catch(a){return!1}},d.showLoading=function(){d.hideLoading(),d.popupAppend('<div id="ld_dialog_0x01" class="loading"><img src="http://cdn.99kgames.com/images/loading.gif"/></div>')},d.hideLoading=function(){d("#ld_dialog_0x01").remove()},d.showNoticeMsg=function(a,b){d("#notice-msg-dialog").size()&&d("#notice-msg-dialog").remove();var c='<div class="up_progress" style="line-height: 20px; z-index: 5000;" id="notice-msg-dialog">'+a+"</div>";TPGAME_CONF&&TPGAME_CONF.playIndex&&(c='<div class="up_progress" style="z-index: 5000;" id="notice-msg-dialog">'+a+"</div>"),d.popupAppend(c),d("#notice-msg-dialog").show(),setTimeout(function(){d("#notice-msg-dialog").remove(),"function"==typeof b&&b()},1500)},d.showErrorMsg=function(a){var b=d("#error-msg-dialog");
if(b.size())b.find("h1").html(a),b.show(),setTimeout(function(){d("#error-msg-dialog").hide()},1e3);else{var c='<div class="sign_popup" style="width: 160px;line-height: 100px; z-index: 5000;" id="error-msg-dialog"><h1 style="margin-top: 0">'+a+"</h1></div>";TPGAME_CONF&&TPGAME_CONF.playIndex&&(c='<div class="sign_popup" style="z-index: 5000;" id="error-msg-dialog"><h1 style="margin-top: 0">'+a+"</h1></div>"),d.popupAppend(c),d("#error-msg-dialog").show(),setTimeout(function(){d("#error-msg-dialog").hide()},1e3)}},d.showMsg=function(a,b){var c=d("#msg-dialog");if(c.size())c.remove();else{var e='<div class="sign_popup" id="msg-dialog" style="height: 43px; z-index: 5000;"><h2>'+a+"</h2></div>";TPGAME_CONF&&TPGAME_CONF.playIndex&&(e='<div class="sign_popup" id="msg-dialog" style="z-index: 5000;"><h2>'+a+"</h2></div>"),d.popupAppend(e),d("#msg-dialog").show(),setTimeout(function(){d("#msg-dialog").remove(),"function"==typeof b&&b()},1500)}},d.showQrCode=function(a){var a=a||"http://cdn.99kgames.com/images/img_v2/ewm.png",b=d("#ewm-dialog-0x01");if(b.size())b.find("span img").attr("src",a),b.show();else{var c='<div class="concern follow_v2" id="ewm-dialog-0x01"><div class="concern_ewm"><div class="colse_btn"><img src="/static/images/close_gray.png" /></div><em><img src="/static/images/popup_top1.png" /></em><b><img src="/static/images/popup_top_text.png" /></b><span><img src="'+a+'"></span><p>微信识别公众号二维码</p></div></div>';d.popupAppend(c),d("#ewm-dialog-0x01").on("click",".colse_btn",function(){d("#ewm-dialog-0x01").hide()})}},d.showVipQrcode=function(a){d("#ewm-dialog-0x02").size()&&d("#ewm-dialog-0x02").remove();var b='<div class="popup_bg" style="display: block;" id="ewm-dialog-0x02"><div class="exclusive_box" style="margin-top:-200px;"><div class="exclusive"><div class="exclusive_top"><em class="close"><img src="/static/images/close_gray.png" /></em><div class="vip_text"><img src="/static/images/vip_text.png" /></div><div class="exclusive_vip_img"><img src="/static/images/vip_img.png" /></div></div><div class="exclusive_bot"><div class="exclusive_ewm"><img src="'+a+'" /></div><p>添加专属客服微信，一对一帮您解决问题<br/><a><i class="blue">点我查看如何添加</i></a></p></div></div></div></div>';d("body").append(b),d("#ewm-dialog-0x02").on("click",".close",function(){d("#ewm-dialog-0x02").remove()})},d.showShare=function(a){d("#share-dialog").size()&&d("#share-dialog").remove();var b='<div class="game_share_pop" id="share-dialog"><em><img src="/static/images/hand.png" /></em><p>'+(a?a:"马上分享给小伙伴")+"</p></div>";d.popupAppend(b),d("#share-dialog").show(),d("#share-dialog").on("click",function(){d("#share-dialog").remove()})},d.showActiveShare=function(){d("#active-share-dialog").size()&&d("#active-share-dialog").remove();var a='<div id="active-share-dialog" class="popup_bg" style="display: block"><div class="bounty_share_pop"><img src="/static/images/bountyMission/share_v3.png"></div></div>';d.popupAppend(a),d("#active-share-dialog").show(),d("#active-share-dialog").on("click",function(){d("#active-share-dialog").remove()})},d.showMasked=function(a,b){d("#masked-dialog").size()&&d("#masked-dialog").remove();var c='<div id="masked-dialog" class="popup_bg" style="display:block"><div class="receive_success can_not_sell" style="margin-top:-100px"><h4 class="txt_c">'+a+"</h4><h5>"+b+'</h5><div class="pop_posi_bot"><a>好的</a></div></div></div>';d.popupAppend(c),d("#masked-dialog").show(),d("#masked-dialog").on("click",function(){d("#masked-dialog").remove()})},d.moreMenu=function(){d("#app-more").off("click").on("click",function(a){return d(".more_box").toggleClass("dn"),!1}),d(document).on("click","*",function(){d(this).closest("#app-more")||d(".more_box").addClass("dn")})},d("#app-more").size()&&d.moreMenu(),d.saveImage=function(a,b){window.MiJSBridge&&a.on("click",function(){console.log("src = "+b[0].src),MiJSBridge.call("saveImage",{image:b[0].src},function(a){console.log(a)})})},d.openUrlInWebView=function(a){var b=TPGAME_CONF.source||TPGAME_CONF.userSource;if(TPGAME_CONF.isInAppView)MiJSBridge.call("open",{url:a.url,showItem:void 0==a.showItem||a.showItem,goback:void 0==a.goback||a.goback});else{var c=a.url;b&&"undefined"!=b&&c.indexOf("source=")==-1&&(c=c.indexOf("?")==-1?c+"?source="+b:c+"&source="+b),a.sharpNum&&(c+=a.sharpNum),location.href=c}},d.safeGoBack=function(a){var b=!0;window.onbeforeunload=function(){b=!1},window.history.back(),a&&setTimeout(function(){b&&(window.location.href=a)},100)},d.openUrl=function(a){var b=TPGAME_CONF.source||TPGAME_CONF.userSource;b&&"undefined"!=b&&a.indexOf("source=")==-1&&(a=a.indexOf("?")==-1?a+"?source="+b:a+"&source="+b),location.href=a},d.closePage=function(a){TPGAME_CONF.isInAppView?MiJSBridge.call("close"):a&&d.openUrl(a)},d.back=function(a){TPGAME_CONF.isInAppView?MiJSBridge.call("close"):d.safeGoBack(a)},d.downApp=function(a){if(TPGAME_CONF&&TPGAME_CONF.isInAppView)window.MiJSBridge&&d.showNoticeMsg("您已下载APP");else if(TPGAME_CONF&&TPGAME_CONF.isWeibo&&2==a){var b='<div class="popup_bg" id="weibo-download-guide" style="display: block"><div class="weibo_guide_pop"><h2>1. 进入游戏下载页</h2><h2>2. 进入下载页后，点击右上角“…”，选择在Safari浏览器中打开</h2><img src="/static/images/weibo_guide_downApp.png"><a>进入下载页</a></div></div>';d("body").append(b),d(document).on("click","#weibo-download-guide",function(){d("#weibo-download-guide").remove()}).on("click","#weibo-download-guide a",function(){d("#weibo-download-guide").remove(),d.openUrl("http://a.app.qq.com/o/simple.jsp?pkgname=com.youxijinbang.app")})}else 1==a?d.openUrl("http://a.app.qq.com/o/simple.jsp?pkgname=com.youxijinbang.app"):2==a&&d.openUrl("http://a.app.qq.com/o/simple.jsp?pkgname=com.youxijinbang.app")},d.safeContent=function(a){return a.replace(/[<>&"]/g,function(a){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[a]})},d.loadScript=function(a,b){var c=document.createElement("script");c.type="text/javascript","function"==typeof b&&(c.readyState?c.onreadystatechange=function(){"loaded"!=c.readyState&&"complete"!=c.readyState||(c.onreadystatechange=null,b())}:c.onload=function(){b()}),c.src=a,document.body.appendChild(c)},d.initWkBackBtn=function(){},d.initHandlebars=function(){var a={};"undefined"!=typeof Handlebars&&d("script").each(function(){var b=d(this);if("text/x-handlebars-template"==b.attr("type")){var c=b.attr("id");a[c]=Handlebars.compile(b.html())}}),window.handlebars=a},d.scrollWindow=function(a,b){function c(){d.ajax({type:"POST",url:a.url,dataType:"json",data:{page:e},success:function(a){return e+=1,b&&b(e,a)===!1?(d("#loading-panel").find("span").hide(),d("#loading-panel").find("p").text("已加载完全部"),!1):void(f=!1)},error:function(a){d("#loading-panel").css("visibility","hidden")}})}window.Game&&Game.handlebarTabIndex&&1!=Game.handlebarTabIndex&&3!=Game.handlebarTabIndex&&(d("#loading-panel").find("span").show(),d("#loading-panel").find("p").text("正在加载中")),"undefined"==typeof Game&&(d("#loading-panel").find("span").show(),d("#loading-panel").find("p").text("正在加载中"));var e=1,f=!1;0==a.page?(e=0,c()):e=parseInt(a.page)||1,d(window).off("scroll").on("scroll",function(){d(window).scrollTop()+d(window).height()>d(document).height()-60&&!f&&(f=!0,c())}),d(".game_popup_con").off("scroll").on("scroll",function(){d(".game_popup_con").scrollTop()+d(window).height()-d(".game_popup_head").height()>d(".game_popup_main").height()-60&&!f&&(f=!0,c())})},d.fn.initWindowScroll=function(a){return d(this).eq(0).each(function(){var b=d(this),c=b.data("url"),e=b.data("template");if(c&&e){var f=0==b.data("page")?0:b.data("page")||1;b.children().size()>=10||0==f?d.scrollWindow({url:c,page:f},function(c,d){var f=handlebars[e](d);if(b.data("page",c).append(f),"function"==typeof a&&a(),d.data.length<10)return!1}):(d(window).off("scroll"),d(".game_popup_con").off("scroll"),d("#loading-panel").find("span").hide(),d("#loading-panel").find("p").text("已加载完全部"))}})},d.initCommonShare=function(){"undefined"!=typeof wx&&wx.ready(function(){wx.hideMenuItems({menuList:["menuItem:share:timeline"]}),window.TPGAME_CONF||(window.TPGAME_CONF={}),TPGAME_CONF.game||(window.TPGAME_CONF.game={});var a="游戏金榜";try{""==(a=d("body").data("title"))&&(a="游戏金榜")}catch(b){a="游戏金榜"}wx.onMenuShareTimeline({title:TPGAME_CONF.game.shareTitle||"小伙伴们，快来和我一起玩游戏",link:TPGAME_CONF.game.shareUrl||"http://wx.99kgames.com/game/list.html",imgUrl:"http://wx.99kgames.com/images/logo.png",success:function(){d.shareSuccess()}}),wx.onMenuShareAppMessage({title:TPGAME_CONF.game.shareTitle||a,desc:TPGAME_CONF.game.shareDesc||"快来和我一起玩游戏",link:TPGAME_CONF.game.shareUrl||"http://wx.99kgames.com/game/list.html",imgUrl:d("#user-avatar").attr("src")||TPGAME_CONF.game.shareFriendIcon||"http://cdn.99kgames.com/images/logo.png",success:function(){d.shareSuccess()}}),wx.onMenuShareQQ({title:TPGAME_CONF.game.shareTitle||a,desc:TPGAME_CONF.game.shareDesc||"快来和我一起玩游戏",link:TPGAME_CONF.game.shareUrl||"http://wx.99kgames.com/game/list.html",imgUrl:d("#user-avatar").attr("src")||TPGAME_CONF.game.shareFriendIcon||"http://cdn.99kgames.com/images/logo.png",success:function(){d.shareSuccess()}})})},window.TPGAME_CONF&&(TPGAME_CONF.isWeixin||!TPGAME_CONF.isInAppView&&!TPGAME_CONF.isInPC)&&d.initCommonShare(),d.initAppShare=function(){d("#share-to-friend").on("click",function(){if(d(".more_box").addClass("dn"),window.MiJSBridge){var a;a=TPGAME_CONF&&TPGAME_CONF.game&&TPGAME_CONF.game.shareAppDetail?{title:TPGAME_CONF.game.shareTitle||"游戏金榜",content:TPGAME_CONF.game.shareDesc||"游戏金榜",image:TPGAME_CONF.game.shareFriendIcon||"http://cdn.99kgames.com/images/logo.png",url:TPGAME_CONF.game.shareUrl||"http://wx.99kgames.com/game/share.html"}:{title:"游戏金榜",content:"游戏金榜",image:"http://cdn.99kgames.com/images/logo.png",url:"http://wx.99kgames.com/game/share.html"},MiJSBridge.call("share",a,function(a){var b="string"==typeof a?d.parseJSON(a):a;0==b.state&&d.shareSuccess()})}else d.showShare()})},window.TPGAME_CONF&&TPGAME_CONF.isInAppView&&d.initAppShare(),d("#wx-share-image").on("click",function(){var a=d(this)[0].src;console.log("src = "+a),window.MiJSBridge&&MiJSBridge.call("saveImage",{image:a},function(a){console.log(a)})}),d("#wx-share-dialog").on("click",".close_yuan",function(){d("#wx-share-dialog").hide()}),d.trackEvent=function(a,b){"undefined"==typeof b&&(b="点击"),_hmt.push(["_trackEvent",a,b])},window.TPGAME_CONF&&TPGAME_CONF.selectMenuClass){d("#bottom_menu").find("a."+TPGAME_CONF.selectMenuClass).addClass("on").siblings("a").removeClass("on");var h=d("#bottom_menu").data("channel");"undefined"!=typeof h&&null!=h&&""!=h?h+="/":h="",d(document).on("click",".menu_mall",function(){d(this).hasClass("on")||d.openUrl("/user/"+h+"shop/list.html")}).on("click",".menu_game",function(){d(this).hasClass("on")||d.openUrl("/game/"+h+"list.html")}).on("click",".menu_package",function(){d(this).hasClass("on")||d.openUrl("/game/"+h+"packlist.html")}).on("click",".menu_my",function(){d(this).hasClass("on")||d.openUrl("/user/"+h+"my.html")}).on("click",".menu_rank",function(){d(this).hasClass("on")||d.openUrl("/game/"+h+"blog/list.html")})}if(d(document).on("click",".show-detail",function(){return d.openUrlInWebView({url:"/game/detail/"+(d(this).data("game")||(window.TPGAME_CONF&&window.TPGAME_CONF.game?TPGAME_CONF.game.code:""))}),!1}),d(document).on("click",".start-game",function(){if(2==d(this).data("desktop")&&window.TPGAME_CONF&&window.TPGAME_CONF.isInPC)d.showNoticeMsg("此游戏暂时不支持PC端");else{var a="/game/play/"+(d(this).data("game")||(window.TPGAME_CONF&&window.TPGAME_CONF.game?TPGAME_CONF.game.code:""));window.TPGAME_CONF&&window.TPGAME_CONF.isInPC&&(d.cookie("tk")||d.cookie("visit_tk"))?d.openUrlInWebView({url:a}):d.openUrlInWebView({url:a})}return!1}).on("click",".game-maintain",function(){return d.showGameMaintain(d(this).data("timeline")),!1}),d(document).on("click",".start-tiny-game",function(){return 2==d(this).data("desktop")&&window.TPGAME_CONF&&window.TPGAME_CONF.isInPC?d.showNoticeMsg("此游戏暂时不支持PC端"):d.openUrlInWebView({url:"/tiny/playing/"+(d(this).data("game")||(window.TPGAME_CONF&&window.TPGAME_CONF.game?TPGAME_CONF.game.code:""))}),!1}),d(document).on("click","#game-maintain-dialog .receive_btn",function(){d("#game-maintain-dialog").remove()}),d(document).on("click",".blog-detail",function(){var a="/game/blog/content/"+d(this).data("id")+".html";return TPGAME_CONF&&TPGAME_CONF.isInPC&&TPGAME_CONF.isLogin?top.open("/game/index.html?redirect_uri="+a):d.openUrlInWebView({url:a}),!1}),d(document).on("click",".trade-detail",function(){return TPGAME_CONF&&TPGAME_CONF.newUserLimitLeft?d("#newer-limit-dialog").show():d.openUrlInWebView({url:"/user/trade/detail/"+d(this).data("record")}),!1}),d(document).on("click",".top-game-index",function(){return d.openUrlInWebView({url:"/game/list.html"}),!1}),d("#newer-limit-dialog").on("click",".receive_btn",function(){d("#newer-limit-dialog").hide()}),d(document).on("click","#subscribe-btn",function(){d.showQrCode(d(this).data("qrcode"))}),d(".swiper-slide").size()&&d(document).on("click",".swiper-slide",function(){var a=d(this).data("url")||"",b=d(this).data("id")||0;0==a.indexOf("http")?TPGAME_CONF.isInPC?top.open(a):d.openUrlInWebView({url:"/game/banner.html?id="+b}):d.openUrlInWebView({url:a})}),d("#mobile-browser-favorite .collect_box").size()){var i=d("#mobile-browser-favorite .collect_box");d.getClientInfo("browser-favorite")||d.getClientInfo("browser-favorite-add")||(i.show(),d.getClientInfo("browser-favorite-first")?i.append('<div class="add_btn">我已添加</div>'):(d.setClientInfo("browser-favorite-first","1"),d.setClientInfo("browser-favorite",(new Date).getTime(),604800))),d("#mobile-browser-favorite .close").on("click",function(){d.setClientInfo("browser-favorite",(new Date).getTime(),604800),d("#mobile-browser-favorite .collect_box").hide()}),d("#mobile-browser-favorite .add_btn").on("click",function(){d("#mobile-browser-favorite .collect_box").hide(),d.setClientInfo("browser-favorite-add","1")})}d.showGameMaintain=function(a){d("#game-maintain-dialog").remove();var b='<div id="game-maintain-dialog" class="popup_bg" style="display: block;"><div class="receive_success maintenance_pop" style=" margin-top: -140px;"><div class="popup_main"><div class="exchange_img"><img src="/static/images/img01.png" /></div><p>该游戏正在维护中请您稍后再试<br/>预计 '+a+' 恢复</p></div><div class="receive_btn"><a>好的</a></div></div></div>';d.popupAppend(b)},d.showLoginDialog=function(a){var b=d("#login-dialog-0x01");if(b.size())b.show();else{var c='<div class="popup_bg" id="login-dialog-0x01"><div class="update_box"><h1>亲，您要登录才能使用此功能哦~</h1><p><a class="fl">取消</a><a class="update_btn fr">确定</a></p></div></div>';d.popupAppend(c),d("#login-dialog-0x01").show(),d("#login-dialog-0x01").on("click",".fl",function(){d("#login-dialog-0x01").remove()}).on("click",".fr",function(){d("#login-dialog-0x01").remove(),d.openUrl("/account/auth.html?redirect_uri="+(a?a:"/game/list.html"))})}},d.showConfirmDialog=function(a){if("object"==typeof a){d("#confirm-dialog").size()&&d("#confirm-dialog").remove();var b='<div class="popup_bg" id="confirm-dialog"><div class="update_box '+(1==a.isLand?"transverse_game_pop":"")+'"><h1>'+a.msg+'</h1><p><a class="fl">'+(a.lMsg?a.lMsg:"取消")+'</a><a class="update_btn fr">'+(a.rMsg?a.rMsg:"确定")+"</a></p></div></div>";d.popupAppend(b),d("#confirm-dialog").show(),d("#confirm-dialog").on("click",".fl",function(){d("#confirm-dialog").remove(),"function"==typeof a.lCallback&&a.lCallback()}).on("click",".fr",function(){d("#confirm-dialog").remove(),"function"==typeof a.rCallback&&a.rCallback()})}},d(document).on("click","#head .goback",function(){a.MiJSBridge&&MiJSBridge.call("close"),TPGAME_CONF.isInPC&&history.back()}),d("#play-goback, #play-reflesh").on("click",function(){"play-goback"==d(this).attr("id")?(a.MiJSBridge&&MiJSBridge.call("close"),TPGAME_CONF.isInPC&&history.back()):"play-reflesh"==d(this).attr("id")&&location.reload()}),d(document).on("click","#app-update",function(){a.MiJSBridge&&MiJSBridge.call("checkUpdate")}).on("click","#logout",function(){a.MiJSBridge&&MiJSBridge.call("userLogout",{},function(a){var b="string"==typeof a?d.parseJSON(a):a;0==b.state&&(d.cookie("tk",null,-1),MiJSBridge.call("close"))})}),d(document).on("click","#app-push",function(){var a=d(this);return a.hasClass("disabled")?void d.showErrorMsg("该应用已禁止接受消息"):(d.showLoading(),void d.ajax({url:"/user/api/push.json",type:"POST",success:function(b){d.hideLoading(),0==b.code?a.toggleClass("on"):alert(b.message)},error:function(){d.hideLoading(),alert("网络不给力,请稍后重试")}}))}).on("click","#app-qrcode",function(){d.openUrlInWebView({url:"/game/qrcode.html"})}).on("click","#about-us",function(){d.openUrlInWebView({url:"/game/aboutus.html"})}),d(document).on("click","#desc",function(){d.openUrlInWebView({url:"/game/desc.html"})}),d.shareSuccess=function(a,b){d("#share").size()>0&&d("#share").hide(),d("#share-dialog").size()>0&&d("#share-dialog").hide(),d("#active-share-dialog").size()>0&&d("#active-share-dialog").trigger("click"),d("#deposit-remind-dialog").size()>0&&d("#deposit-remind-dialog .close").trigger("click");var c={};window.TPGAMEPLAY?c={gameId:TPGAME_CONF.game.id,depositShare:1}:window.TPGAME_CONF&&TPGAME_CONF.depositFlaunt?c={depositFlaunt:1}:window.TPGAME_CONF&&TPGAME_CONF.depositShare&&(c={gameId:TPGAME_CONF.game.id,depositShare:1}),d.ajax({url:"/game/api/share.json",data:c,type:"POST",dataType:"json",success:function(c){if(0==c.code)if("function"==typeof a)b="object"!=typeof b?{}:b,b.result=c,a(b);else if(TPGAME_CONF&&TPGAME_CONF.depositShare)50==c.code&&d.showNoticeMsg(c.message);else if(!TPGAME_CONF||!TPGAME_CONF.gamePlay){var e=d("#share_success_popup");if(e.size())e.show();else{var f='<div class="sign_popup" id="share_success_popup"><h1>分享成功</h1><h2><i>+'+c.income+"</i>积分</h2></div>";d.popupAppend(f),d(".share").size()>0&&d(".share").removeClass("share").text("已完成").parent("div.game_begin").addClass("game_gray"),d("#share_success_popup").show()}setTimeout(function(){d("#share_success_popup").remove()},2e3)}}}),window.TPGAMEPLAY&&window.TPGAMEPLAY.noticeShareSuccess&&TPGAMEPLAY.noticeShareSuccess()},d.userCollect=function(a,b,c){(TPGAME_CONF.isLogin||0==window.location.pathname.indexOf("/user/"))&&d.ajax({url:"/user/api/collect_status.json",type:"POST",data:a,dataType:"json",success:function(a){1==a.code&&("function"==typeof b?b():d("#user-collect-btn").find("b").addClass("on").find("p").text("已收藏"))}}),d("#user-collect-btn").on("click",function(){TPGAME_CONF.isLogin||0==window.location.pathname.indexOf("/user/")?(d.showLoading(),d(this).find("b").hasClass("on")?d.ajax({url:"/user/api/remove_collect.json",type:"POST",data:a,dataType:"json",success:function(a){d.hideLoading(),0==a.code&&("function"==typeof c?(c(),d.showNoticeMsg(a.message)):(d("#user-collect-btn").find("b").removeClass("on").find("p").text("收藏"),d.showNoticeMsg(a.message)))}}):d.ajax({url:"/user/api/add_collect.json",type:"POST",data:a,dataType:"json",success:function(a){d.hideLoading(),0==a.code&&("function"==typeof b?(b(),d.showNoticeMsg(a.message)):(d("#user-collect-btn").find("b").addClass("on").find("p").text("已收藏"),d.showNoticeMsg(a.message)))}})):window.Login?Login.commonLoginDialog():window.location.reload()})},window.MiJSBridge?b():document.addEventListener("MiJSBridgeReady",b),d(function(){var a=d.getClientInfo("dragon_boat_read_do");null!=a&&1==a?d("#dragoon_boat_red_do").html(""):d("#dragoon_boat_red_do").html('<b class="red_dot"></b>')}),d(function(){d("#bottom_menu").size()>0&&""==d("#bottom_menu").data("channel")&&TPGAME_CONF.isLogin&&(1==d.getClientInfo("chat_message_red_dot")&&d(".center_icon").html('<b class="red_dot"></b>'),!Constant.isLotteryNoticeDialogOn||d.getClientInfo("zhuanpan_dot")&&1!=d.getClientInfo("zhuanpan_dot")||d(".mall_icon").html('<b class="red_dot"></b>'))}),d(function(){"zuji"!=d.cookie("c_index")&&"bfyfjapp"!=d.cookie("c_index")||(d("#m-wechat-login").closest("li").remove(),d("#wechat-login-1").remove(),d("#login-tip ul li").attr("style","width:33.33%"))})}(window),TP_BLOG={publish:function(){function a(a){function c(){$.showLoading(),$.ajax({url:"/user/api/blog.json",type:"POST",data:a,dataType:"json",success:function(a){if($.hideLoading(),0==a.code||1==a.code){b=!1,$.cookie("publishTime",1e3*parseInt(Date.now()),60);var c="发布成功";1==a.code&&(c+=","+a.message),$.showNoticeMsg(c,function(){$.openUrl("/game/blog/list.html")})}else a.code==-10?$.showMasked("发布失败",a.message):$.showNoticeMsg(a.message)},error:function(){$.hideLoading(),$.showNoticeMsg("请稍后重试")}})}a.relation&&a.relation>0?c():2==a.type?$.showNoticeMsg("无可用商品"):1==a.type?$.showNoticeMsg("无可用游戏"):0==a.type&&c()}var b=!0,c={};$("#blog-publish").on("click",function(){if(b){c.content=$("#target").val(),c.images=TP_COMMENT.getImages(),c.type=TPGAME_CONF.type,c.relation=$("#blog-relation").data("id");var d="";if("object"!=typeof c)return!1;c.content.length<2?d="您输入的文字太少了哦":c.content.length>2e3&&(d="您输入的文字太多了哦"),d?$.showNoticeMsg(d):1==$("#blog-relation").data("type")?$.showConfirmDialog({msg:"商品尚未上架，待交易商品审核成功后<br/>方可进行交易",rCallback:function(){a(c)}}):a(c)}else $.showNoticeMsg("请不要重复操作")}),TP_COMMENT.initUpload(6),$("#blog-relation").on("click",function(){$("#select-box").show()}),$("#select-box").on("click",function(){$("#select-box").hide()}).on("click",".inner_text",function(){return!1}).on("click","li",function(){var a=$(this).data("id"),b=$(this).data("type"),c=$(this).find("img").attr("src"),d=$(this).find("p").text();return $("#select-box").hide(),$("#blog-relation").attr("data-id",a),$("#blog-relation").attr("data-type",b),$("#blog-relation").find(".blog_relation_head img").attr("src",c),$("#blog-relation").find(".blog_relation_text p").text(d),!1}),$(".select_other_accont, #blog-trade-no").on("click",function(){return $.openUrlInWebView({url:"/user/trade/create.html"}),!1})},blogList:function(){$("#index-btn").on("click",function(){$.openUrlInWebView({url:"/recharge/rank.html"})}),$(".blog-rule").on("click",function(){$.openUrlInWebView({url:"/game/blog/rule.html"})}),$("#blog-login").on("click",function(){Login.commonLoginDialog()}),$.initHandlebars(),$("#blog-list").children().initWindowScroll(),$(".comment_input_enter").on("click",function(){TPGAME_CONF.isLogin?TPGAME_CONF.blogMasked?TPGAME_CONF.lowCredit?$.showMasked("无法使用","您的信用值太低，部分社区功能无法使用，如有疑问请联系客服"):$.showMasked("无法使用","您已被系统封禁，部分社区功能无法使用，如有疑问请联系客服"):($("#publish-box").hide(),$("#blog-type-select").show()):Login.commonLoginDialog()}),$("#blog-type-select").on("click","li",function(){var a=$(this).data("type");2==a?TPGAME_CONF.newUserLimitLeft?$("#newer-limit-dialog").show():$.openUrlInWebView({url:"/game/blog/publish.html?type=2"}):$.openUrlInWebView({url:"/game/blog/publish.html?type="+a})}),$(".blog_type_close").on("click",function(){$("#blog-type-select").hide(),$("#publish-box").show()}),TPGAME_CONF.isLogin&&($("#message-btn").on("click",function(){$.openUrlInWebView({url:"/game/blog/message.html"})}),$.ajax({url:"/game/api/recent_review_num.json",type:"POST",dataType:"json",success:function(a){0==a.code&&$("#message-btn").html("<span>"+a.message+"+</span>")}})),$("#user-info-container").on("click",".checkin-btn",function(){TPGAME_CONF.isLogin?$("#checkin-dialog").show():Login.commonLoginDialog()}),$("#checkin-dialog").one("click","#dice-btn:not(.has_signed)",function(){if(TPGAME_CONF.isLogin){var a=$(this);a.addClass("has_signed"),a.prev("img").prop("src","/static/images/serial_sign/dice_result0.gif"),$.ajax({url:"/user/api/checkin.json",type:"POST",dataType:"json",success:function(b){0==b.code&&setTimeout(function(){$(".blog-award").text(parseInt($(".blog-award").text())+parseInt(b.award)),$(".check_in").removeClass("check_in").addClass("check_out").html("已签到"),a.prev("img").prop("src","/static/images/serial_sign/dice_result"+b.luckyNum+".png"),$(".today_sign").addClass("has_signed"),$(".today_sign .dice_icon").children().get(0).remove(),$(".today_sign .dice_icon").prepend('<img src="/static/images/serial_sign/dice_icon'+b.luckyNum+'.png"/>'),$(".today_sign .add_score").html("+"+b.income);var c='<div class="sign_popup" id="checkin_success_popup" style="display: block"><h1>签到成功</h1><h2><i>+'+b.income+"</i>积分</h2></div>";$("body").append(c),setTimeout(function(){$("#checkin_success_popup").remove()},2e3)},3e3)},error:function(){a.prev("img").prop("src","/static/images/serial_sign/dice_result1.png"),$.showNoticeMsg("请刷新后重试")}})}else Login.commonLoginDialog()}).on("click",".close",function(){$("#checkin-dialog").hide()}),$("#blog-level-up").on("click",".btn, .close",function(){$("#blog-level-up").remove()}),TP_COMMENT.avatarClickCount()},autoImg:function(){var a=parseInt($(window).width())-20;$(".comment_pic_box .one_pic img").each(function(b){var c,d,e=$(this);$("<img/>").attr("src",$(e).attr("src")).load(function(){c=this.width,d=this.height,c>=a||d>230?$(e).addClass("cut_img"):c>d?$(e).css("width","100%").css("height","auto"):d>c&&$(e).css("width","auto").css("height","230px")})})},blogContent:function(){TPGAME_CONF.isLogin?($.ajax({url:"/user/api/thumb_status.json",type:"POST",data:{blogId:TPGAME_CONF.blogId},dataType:"json",success:function(a){TPGAME_CONF.thumbReviews=a.data,TP_BLOG.checkThumbs(TPGAME_CONF.thumbReviews)}}),$.ajax({url:"/user/api/collect_status.json",type:"POST",data:{type:1,related_id:TPGAME_CONF.blogId},dataType:"json",success:function(a){1==a.code&&$("#operate-menu .operate-collect").data("collect","1").text("取消收藏")}})):$("#target").focus(function(){$(this).blur(),Login.commonLoginDialog()}),$.initHandlebars(),$("#review-list").children().not("h2").initWindowScroll(function(){TPGAME_CONF.thumbReviews&&TP_BLOG.checkThumbs(TPGAME_CONF.thumbReviews)}),$("#review-publish").on("click",function(){if(TPGAME_CONF.isLogin){var a=$("#target").attr("placeholder");"请输入回复"==a&&(a="");var b={};b.content=$("#target").val(),b.post_id=TPGAME_CONF.blogId,b.reply_comment_id=$("#review-publish").data("id"),b.images=TP_COMMENT.getImages();var c="";if("object"!=typeof b)return!1;b.content.length<2?c="您输入的文字太少了哦":b.content.length>200&&(c="您输入的文字太多了哦"),c?$.showNoticeMsg(c):($.showLoading(),$.ajax({url:"/user/api/review.json",type:"POST",data:b,dataType:"json",success:function(c){if($.hideLoading(),0==c.code||1==c.code){$("#target").val(""),$.cookie("reviewTime",1e3*parseInt(Date.now()),20),1==c.code?$.showNoticeMsg("发布成功,"+c.message):$.showNoticeMsg("发布成功");var d='<div class="comment_list review-'+c.reviewId+'" data-id="'+c.reviewId+'" data-user="'+TPGAME_CONF.self+'"><div class="game_list_box"><em class="chat-intention"><img src="'+TPGAME_CONF.avatar+'"></em><div class="game_list_text"><h1><a class="user_name">'+TPGAME_CONF.nickname+'</a><span class="diamond '+TPGAME_CONF.blogStyle+'"></span></h1><h2>刚刚</h2></div><p class="thumb_up"><font>0</font><span></span></p><p class="more"></p></div><p class="comment_text">'+a+b.content+"</p></div>";$("#review-list-handlebar").append(d),$("#review-list").hasClass("dn")&&$("#review-list").removeClass("dn"),$("#review-publish").data("id","0"),$("#target").css("height","30px").attr("placeholder","请输入回复")}else 2==c.code?location.reload():c.code==-10?$.showMasked("无法评论",c.message):$.showNoticeMsg(c.message)},error:function(){$.hideLoading(),$.showNoticeMsg("请稍后重试")}}))}else Login.commonLoginDialog()}),$("#screen-images img").on("click",function(){var a=$(this).attr("src"),b=$("#screen-images img").map(function(){return $(this).attr("src")}).get();if(TPGAME_CONF.isInAppView){var c=$(this).parent("div").index();MiJSBridge.call("viewImage",{images:b,index:c})}else window.wx&&wx.previewImage({current:a,urls:b})}),setTimeout(function(){var a=$("#blog-content .comment_list").not(".comment_text, comment_pic_box");a.find("img").css({"max-width":"300px"}).closest("p").css({"text-indent":"0pt"}),a.find("img").closest("span").css({"text-indent":"0pt"}).closest("p").css({"text-indent":"0pt"})},100),setTimeout(function(){$.ajax({url:"/game/api/blog_read_count.json",type:"POST",data:{blogId:TPGAME_CONF.blogId},dataType:"json",success:function(a){0==a.code&&$.cookie("lastReadBlog",TPGAME_CONF.blogId,86400)}})},5e3),$("#blog-content").on("click",".more",function(){return $("#operate-menu").data("id",-1),$("#operate-menu").data("name",""),$(".operate-collect").show(),TPGAME_CONF.authorView?($(".operate-report").hide(),$(".operate-delete").show()):($(".operate-report").show(),$(".operate-delete").hide()),$("#operate-menu").show(),!1}),$("#review-list").on("click",".more",function(){var a=$(this).closest(".comment_list").data("id"),b=$(this).closest(".comment_list").find(".user_name").text();return $("#operate-menu").data("id",a),$("#operate-menu").data("name",b),$(".operate-collect").hide(),TPGAME_CONF.authorView||$(this).closest(".comment_list").data("user")==TPGAME_CONF.self?($(".operate-report").hide(),$(".operate-delete").show()):($(".operate-report").show(),$(".operate-delete").hide()),$("#operate-menu").show(),!1}),$("#operate-menu").on("click",function(){$("#operate-menu").hide()}).on("click",".operate-cancel",function(){$("#operate-menu").hide()}).on("click",".operate-report",function(){return $("#operate-menu").hide(),$("#report-dialog").data("id",$("#operate-menu").data("id")),$("#report-dialog").show(),!1}).on("click",".operate-reply",function(){return $("#operate-menu").hide(),$("#review-publish").data("id",$("#operate-menu").data("id")),$("#target").attr("placeholder","回复"+$("#operate-menu").data("name")+"：").focus(),!1}).on("click",".operate-collect",function(){var a=$(this);return $("#operate-menu").hide(),TPGAME_CONF.isLogin?($.showLoading(),0==$(this).data("collect")?$.ajax({url:"/user/api/add_collect.json",type:"POST",data:{type:1,related_id:TPGAME_CONF.blogId},dataType:"json",success:function(b){$.hideLoading(),0==b.code&&(a.data("collect","1").text("取消收藏"),$.showNoticeMsg(b.message))}}):$.ajax({url:"/user/api/remove_collect.json",type:"POST",data:{type:1,related_id:TPGAME_CONF.blogId},dataType:"json",success:function(b){$.hideLoading(),0==b.code&&(a.data("collect","0").text("收藏"),$.showNoticeMsg(b.message))}})):Login.commonLoginDialog(),!1}).on("click",".operate-delete",function(){var a=$(this).closest("#operate-menu");return $("#operate-menu").hide(),$("#delete-dialog").data("id",a.data("id")).show(),!1}),$("#delete-dialog").on("click",".cancel-on",function(){$("#delete-dialog").hide()}).on("click",".on",function(){var a=$("#delete-dialog").data("id");$("#delete-dialog").hide(),$.showLoading(),$.ajax({url:"/user/api/blog_delete.json",type:"POST",data:{blogId:TPGAME_CONF.blogId,reviewId:a},dataType:"json",success:function(a){$.hideLoading(),$.showNoticeMsg(a.message),0==a.code?$.back("/game/blog/list.html"):1==a.code?location.reload():2==a.code&&location.reload()},error:function(){$.hideLoading(),$.showNoticeMsg("请稍后重试")}})}),$("#report-dialog").on("click",".cancel-on",function(){$("#report-dialog").hide()}).on("click",".on",function(){var a=$(this).closest("#report-dialog").data("id");if(TPGAME_CONF.isLogin){$("#report-dialog").hide(),$.showLoading();var b="社区举报";$.ajax({url:"/user/api/blog_report.json",type:"POST",data:{blogId:TPGAME_CONF.blogId,reviewId:a,content:b},dataType:"json",success:function(a){$.hideLoading(),a.code==-10?$.showMasked("无法举报",a.message):$.showNoticeMsg(a.message)},error:function(){$.hideLoading(),$.showNoticeMsg("请稍后重试")}})}else Login.commonLoginDialog()}),$(document).on("click",".thumb_up",function(){var a=$(this),b=a.closest(".comment_list").data("id");return TPGAME_CONF.isLogin?a.find("span").hasClass("on")||($.showLoading(),$.ajax({url:"/user/api/blog_thumb.json",type:"POST",data:{blogId:TPGAME_CONF.blogId,reviewId:b},dataType:"json",success:function(b){if($.hideLoading(),b.code>=0){var c=a.find("font").text();a.find("span").addClass("on animated bounceIn"),a.find("font").text(parseInt(c)+1),1==b.code&&setTimeout(function(){$.showNoticeMsg(b.message)},800)}else b.code==-2?(a.find("span").addClass("on"),$.showNoticeMsg(b.message)):b.code==-10?$.showMasked("无法点赞",b.message):$.showNoticeMsg(b.message)},error:function(){$.hideLoading(),$.showNoticeMsg("请稍后重试")}})):Login.commonLoginDialog(),!1}),$("#review-list").on("click",".comment_text",function(){
$("#review-publish").data("id",$(this).closest(".comment_list").data("id")),$("#target").attr("placeholder","回复"+$(this).closest(".comment_list").find(".user_name").text()+"：").focus()}),$("#blog-content").on("click",".comment_text",function(){$("#review-publish").data("id",-1),$("#target").attr("placeholder","请输入回复").focus()}),setTimeout(function(){$("#image-info-input").hide()},100),$("#image-publish").on("click",function(){TPGAME_CONF.isLogin?$("#image-info-input").show():Login.commonLoginDialog()}),$("#target").focus(function(){$("#image-info-input").hide()}),TP_COMMENT.initUpload(6),TP_COMMENT.avatarClickCount(),TP_BLOG.voteOptions()},checkThumbs:function(a){for(var b=0;b<a.length;b++)$("#review-list").find(".review-"+a[b]).find(".thumb_up span").addClass("on")},messageList:function(){$.initHandlebars(),$("#message-list").children().initWindowScroll(),$("#message-list").on("click",".comment_list",function(){$.openUrlInWebView({url:"/game/blog/content/"+$(this).data("blog")+".html"})}),$.cookie("pastMessageTime",1e3*parseInt(Date.now()))},voteOptions:function(){if($("#blog-vote-content .can-vote").on("click","li",function(){$(this).addClass("on").siblings().removeClass("on")}),$("#blog-vote-content").on("click","#vote-btn",function(){if(TPGAME_CONF.isLogin){$.showLoading();var a=$("#blog-vote-content .can-vote li.on").map(function(){return $(this).data("id")}).get().join();""==a.trim()?($.hideLoading(),$.showNoticeMsg("您还未选择哦")):$.ajax({url:"/user/api/blog_vote.json",type:"POST",data:{blogId:TPGAME_CONF.blogId,voteIds:a},dataType:"json",success:function(a){$.hideLoading(),$.showNoticeMsg(a.message),0==a.code&&window.location.reload()},error:function(){$.hideLoading(),$.showNoticeMsg("请稍后重试")}})}else Login.commonLoginDialog()}),TPGAME_CONF.voteIds)for(var a=TPGAME_CONF.voteIds.split(","),b=0;b<a.length;b++)$("#vote-option-"+a[b]).find(".option-content").append("（我选择的）")}},TP_COMMENT={prevTime:0,isEmojiInit:!1,isEmojiShow:0,commentPublish:function(){$("#comment-publish").on("click",function(){var a=$(this);if(TPGAME_CONF.isLogin){var b={};b.content=$("#target").val(),b.related_id=0,b.type=0,b.reply_comment_id=a.data("reply"),0==window.location.pathname.indexOf("/user/trade/detail/")&&(b.related_id=TPGAME_CONF.record_id,b.type=1);var c="";if("object"!=typeof b)return!1;b.content.length<2?c="您输入的文字太少了哦":b.content.length>200&&(c="您输入的文字太多了哦"),c?$.showNoticeMsg(c):($.showLoading(),$.ajax({url:"/user/api/comment.json",type:"POST",data:b,dataType:"json",success:function(a){if($.hideLoading(),0==a.code){if($("#comment-publish").attr("data-reply",0),$("#target").val("").css("height","30px"),$.cookie("commentTime",1e3*parseInt(Date.now()),20),$.showNoticeMsg("发布成功"),0==window.location.pathname.indexOf("/user/trade/detail/")){var c=$("#target").attr("placeholder");"请输入回复"==c&&(c="");var d='<div class="comment_list" data-id="'+a.commentId+'"><div class="game_list_box"><em><img src="'+TPGAME_CONF.avatar+'"></em><div class="game_list_text"><h1><a class="user_name">'+TPGAME_CONF.nickname+'</a></h1><h2>刚刚</h2></div><b class="more"></b></div><p class="comment_text">'+c+b.content+'</p><div class="border_blank"></div></div>',e=$("#comment-list").find(".message_title font").text();$("#comment-list").find(".message_title font").text(parseInt(e)+1),$("#comment-list").find(".has_message").append(d),$("#comment-list").find(".no_message").attr("class","all_comment has_message").html(d)}$("#target").attr("placeholder","请输入回复").blur()}else a.code==-10?$.showMasked("无法留言",a.message):$.showNoticeMsg(a.message,function(){$("#target").focus()})},error:function(){$.hideLoading(),$.showNoticeMsg("请稍后重试")}}))}else Login&&Login.commonLoginDialog()}),$("#comment-list").on("click",".comment_text",function(){var a=$(this);$("#comment-publish").attr("data-reply",a.closest(".comment_list").data("id")),$("#target").attr("placeholder","回复"+a.closest(".comment_list").find(".user_name").text()+"：").focus(),setTimeout(function(){$("#comment-btn").size()&&($("#pay-module").hide(),$("#comment-module").show(),$("#target").focus())},500)})},commentDelete:function(a){$("#comment-list").on("click",".more",function(){var a=$(this).closest(".comment_list").data("id");return $("#operate-menu").data("id",a).show(),!1}),$("#operate-menu").on("click",function(){$("#operate-menu").hide()}).on("click",".operate-cancel",function(){$("#operate-menu").hide()}).on("click",".operate-delete",function(){var a=$(this).closest("#operate-menu");return $("#operate-menu").hide(),$("#delete-dialog").data("id",a.data("id")).show(),!1}),$("#delete-dialog").on("click",".cancel-on",function(){$("#delete-dialog").hide()}).on("click",".on",function(){var b=$("#delete-dialog").data("id");$("#delete-dialog").hide(),$.showLoading(),$.ajax({url:"/user/api/comment_delete.json",type:"POST",data:{relatedId:a,commentId:b},dataType:"json",success:function(a){$.hideLoading(),a.code>=0?$.showNoticeMsg(a.message,function(){window.location.reload()}):$.showNoticeMsg(a.message)},error:function(){$.hideLoading(),$.showNoticeMsg("请稍后重试")}})})},initTradeUpload:function(){var a=$(".update_pic ul li a img").width()+"px";$(".update_pic ul li a img").css("height",a),$("#image-box").on("click","em",function(){return $(this).closest("li").remove(),$("#upload-image").show(),!1});var b={auto:!0,max:8,compress:{width:1280,height:1280},data:{token:TPGAME_CONF.qiniuToken,prefix:"trade"},pickedCallback:function(a,b){$("#upload-image").before('<li id="img-'+a.id+'"><a><img src="'+b+'" /><em></em></a></li>'),$("#image-box li").not("#upload-image").length>=8&&$("#upload-image").hide(),$.showLoading()},uploadedCallback:function(a,b){b&&b.key&&$("#img-"+a.id).data("url","https://cache.99kgames.com/"+b.key),$.hideLoading()},uploadError:function(a){$.showNoticeMsg("此上传图片出错"),$.hideLoading()},uploadFinished:function(){}};uploader=$.webUpload("#upload-image","https://up.qbox.me/",b),$("#image-box").on("click","li:not(:last)",function(){var a=this;window.MiJSBridge&&MiJSBridge.call("viewImage",{images:$("#image-box li").not("#upload-image").map(function(){return $(this).data("url")}).get(),index:$(a).index()})})},initUpload:function(a){var b=$(".update_pic ul li a img").width()+"px";$(".update_pic ul li a img").css("height",b),$("#image-box").on("click","em",function(){return $(this).closest("li").remove(),$("#upload-image").show(),!1});var c={auto:!0,max:a||1,compress:{width:1280,height:1280},data:{token:TPGAME_CONF.qiniuToken,prefix:"blog"},pickedCallback:function(a,b){$("#upload-image").before('<li class="swiper-slide" id="img-'+a.id+'"><a><img src="'+b+'" /><em></em></a></li>'),$("#image-box li").not("#upload-image").length>=8&&$("#upload-image").hide(),$.showLoading()},uploadedCallback:function(a,b){b&&b.key&&$("#img-"+a.id).data("url","https://cache.99kgames.com/"+b.key),$.hideLoading()},uploadError:function(a){$.showNoticeMsg("此上传图片出错"),$.hideLoading()},uploadFinished:function(){}};uploader=$.webUpload("#upload-image","https://up.qbox.me/",c)},getImages:function(){return $("#image-box li").not("#upload-image").map(function(){return $(this).data("url")}).get().join()},avatarClickCount:function(){$(document).on("click",".chat-intention",function(){var a=$(this).data("user");return $.trackEvent("用户头像"),a>0&&$.openUrlInWebView({url:"/user/trade/seller_info.html?id="+a}),!1})},contentAutoHeight:function(){function a(a,d,e){function f(){c("_textareacopy").value=c(a).value,c("_textareacopy").scrollHeight>120&&(c(a).style.height=c("_textareacopy").scrollHeight+parseInt(c("_textareacopy").style.height)-20+"px")}if(!c("_textareacopy")){var g=document.createElement("textarea");g.id="_textareacopy",g.style.position="absolute",g.style.left="-9999px",g.style.width=c(a).offsetWidth+"px",g.style.height="24px",g.style.lineHeight="24px",g.style.fontSize=d+"px",g.style.padding=e+"px",g.style.boxSizing="border-box",g.style.resize="none",document.body.appendChild(g)}b(c("target"),"propertychange",f),b(c("target"),"input",f),c(a).style.overflow="hidden",c(a).style.resize="none"}var b=window.addEventListener?function(a,b,c){a.addEventListener(b,c)}:function(a,b,c){a.attachEvent("on"+b,c)},c=function(a){return document.getElementById(a)};b(window,"load",function(){a("target",14,0)})},reviewAutoHeight:function(){function a(a,d,e){function f(){c("_textareacopy").value=c(a).value,c(a).style.height=c("_textareacopy").scrollHeight-28+parseInt(c("_textareacopy").style.height)+"px",c("_textareacopy").scrollHeight<=20&&(c(a).style.height="30px",c(a).style.lineHeight="30px"),c("_textareacopy").scrollHeight>=30&&(c(a).style.lineHeight="20px",c(a).style.height=c("_textareacopy").scrollHeight+parseInt(c("_textareacopy").style.height)-20+"px",c("_textareacopy").style.lineHeight="20px",c("_textareacopy").style.height="20px"),c("_textareacopy").scrollHeight>=120&&(c(a).style.height="120px",c(a).style.overflowY="scroll")}if(!c("_textareacopy")){var g=document.createElement("textarea");g.id="_textareacopy",g.style.position="absolute",g.style.left="-9999px",g.style.width=c(a).offsetWidth+"px",g.style.height=c(a).offsetHeight+"px",g.style.lineHeight=c(a).style.lineHeight+"px",g.style.fontSize=d+"px",g.style.paddingLeft=e+"px",g.style.boxSizing="border-box",g.style.resize="none",document.body.appendChild(g)}b(c("target"),"propertychange",f),b(c("target"),"input",f),c(a).style.overflow="hidden",c(a).style.resize="none"}var b=window.addEventListener?function(a,b,c){a.addEventListener(b,c)}:function(a,b,c){a.attachEvent("on"+b,c)},c=function(a){return document.getElementById(a)};if(b(window,"load",function(){a("target",15,10)}),TPGAME_CONF.isWeixin){var d=document.body.scrollTop;$("#target").focus(function(){$(".emoji_package").size()&&TP_COMMENT.hideEmoji(),setTimeout(function(){document.body.scrollTop=document.body.scrollHeight},500)}).blur(function(){document.body.scrollTop=d})}else $("#target").focus(function(){$(".emoji_package").size()&&TP_COMMENT.hideEmoji()})},sendChatMsg:function(a){var b=this,c={};return c.content=a,c.chatId=TPGAME_CONF.chat_id,c.receiver=TPGAME_CONF.otherUserId,"object"==typeof c&&void(b.validMsg(c.content)&&($.showLoading(),$.ajax({url:"/user/api/chat/send_message.json",type:"POST",data:c,dataType:"json",success:function(a){$.hideLoading(),0==a.code?(b.prevTime=Date.now(),0!=c.content.indexOf("[topEmoji_")&&$("#target").val("").css("height","30px")):$.showNoticeMsg(a.message)},error:function(){$.hideLoading(),$.showNoticeMsg("请稍后重试")}})))},receiveChatMsg:function(){var a=$("#message-list > div").last().data("id");$.ajax({url:"/user/api/chat/receive_message.json",type:"POST",data:{chatId:TPGAME_CONF.chat_id,messageId:a},dataType:"json",success:function(a){if(0==a.code){var b=Handlebars.compile($("#message-list-template").html()),c=b(a);$("#message-list").append(c),c.length>1&&$("#message-list > div").last().get(0).scrollIntoView()}}})},validMsg:function(a){var b=this;return Date.now()-b.prevTime<=5e3?($.showNoticeMsg("发送消息太频繁"),!1):a.length<1?($.showNoticeMsg("您输入的文字太少了哦"),!1):!(a.length>100)||($.showNoticeMsg("您输入的文字太多了哦"),!1)},initEmoji:function(){var a=this;$("#emoji-btn").on("click",function(){$.cookie("tk")?0==a.isEmojiShow?a.showEmoji():a.hideEmoji():$("#login-dialog").show()}),$(".emoji_package .swiper-slide img").on("click",function(){var b="[topEmoji_"+$(this).data("index")+"]";a.sendChatMsg(b),a.hideEmoji()})},showEmoji:function(){var a=this;a.isEmojiShow=1,$("#emoji-btn").find("img").prop("src","/static/images/keyboard_icon.png"),$(".emoji_package").show().height($(".swiper-container").height()-(a.isEmojiInit?0:15)),$("#emoji-btn").parent().css({bottom:$(".emoji_package").height()}),!a.isEmojiInit&&new Swiper(".emoji_package .swiper-container",{pagination:".swiper-pagination",direction:"horizontal"}),a.isEmojiInit=!0},hideEmoji:function(){var a=this;a.isEmojiShow=0,$("#emoji-btn").find("img").prop("src","/static/images/face_icon.png"),$("#emoji-btn").parent().css({bottom:0}),$(".emoji_package").hide()}},function(a){"use strict";function b(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}if("undefined"==typeof c)var c={};if("undefined"==typeof d)var d={};Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f="undefined"!=typeof Blob&&function(){try{return Boolean(new Blob)}catch(a){return!1}}(),g=f&&"undefined"!=typeof Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(a){return!1}}(),h="undefined"!=typeof HTMLCanvasElement&&HTMLCanvasElement.prototype.toBlob,i=h||"undefined"!=typeof Uint8Array&&"undefined"!=typeof ArrayBuffer&&"undefined"!=typeof atob,j="undefined"!=typeof FileReader||"undefined"!=typeof URL,k=function(){function a(){b(this,a)}return e(a,null,[{key:"resize",value:function(b,c,d){"function"==typeof c&&(d=c,c={width:640,height:480});c.width,c.height;if(!a.isSupported()||!b.type.match(/image.*/))return d(b,!1),!1;if(b.type.match(/image\/gif/))return d(b,!1),!1;var e=document.createElement("img");return e.onload=function(f){var g=e.width,i=e.height,j=!1;if(g>i&&g>c.width?(i*=c.width/g,g=c.width,j=!0):i>c.height&&(g*=c.height/i,i=c.height,j=!0),!j)return void d(b,!1);var k=document.createElement("canvas");k.width=g,k.height=i;var l=k.getContext("2d");if(l.drawImage(e,0,0,g,i),h)k.toBlob(function(a){d(a,!0)},b.type);else{var m=a._toBlob(k,b.type);d(m,!0)}},a._loadImage(e,b),!0}},{key:"_toBlob",value:function(a,b){var c=a.toDataURL(b),d=c.split(","),e=void 0;e=d[0].indexOf("base64")>=0?atob(d[1]):decodeURIComponent(d[1]);for(var h=new ArrayBuffer(e.length),i=new Uint8Array(h),j=0;j<e.length;j+=1)i[j]=e.charCodeAt(j);var k=d[0].split(":")[1].split(";")[0],l=null;if(f)l=new Blob([g?i:h],{type:k});else{var m=new BlobBuilder;m.append(h),l=m.getBlob(k)}return l}},{key:"_loadImage",value:function(a,b,c){if("undefined"==typeof URL){var d=new FileReader;d.onload=function(b){a.src=b.target.result,c&&c()},d.readAsDataURL(b)}else a.src=URL.createObjectURL(b),c&&c()}},{key:"isSupported",value:function(){return"undefined"!=typeof HTMLCanvasElement&&i&&j}}]),a}();c["default"]=k,d.exports=c["default"],a.webUpload=function(b,c,d){function e(a){d.beforeUploadStart&&d.beforeUploadStart(a),l=0,m=0,n=0;for(var b=0,c=0;b<a.length;++b){var e=a[b],i=window.URL.createObjectURL(e);e.ext=f(e),e.uuid=g(),e.id=e.uuid,d.pickedCallback&&d.pickedCallback(e,i,b)===!1||(c+=1,c>d.max?d.uploadError&&d.uploadError(e,new Error("超过设定的文件数量"),b):(l+=1,d.compress?!function(a,b){k.resize(b,d.compress,function(c,d){h(a,b,c)})}(b,e):!function(a,b){h(a,b,b)}(b,e)))}}function f(a){var b=a.name.lastIndexOf(".");return b>=0?a.name.substring(b):""}function g(){var a=Math.random()+"";a=a.substring(2);var b=(new Date).getTime().toString(16)+parseInt(a).toString(16);return b.toUpperCase()}function h(b,e,f){var g=new FormData;if(g.append(d.name,f),d.data){for(var h in d.data)d.data.hasOwnProperty(h)&&g.append(h,d.data[h]);if(d.data.prefix){var h=d.data.prefix+"/"+e.uuid+e.ext;g.append("key",h)}}d.beforeFileUpload&&d.beforeFileUpload(e,g,b)===!1||("function"==typeof window.fetch?fetch(c,{method:"post",body:g}).then(function(a){a.ok?a.text().then(function(a){var c=a;try{c=JSON.parse(a)}catch(d){}i(e,c,b)}):j(e,new Error(a.statusText),b)},function(a){j(e,a,b)}):a.ajax({url:c,type:"POST",cache:!1,data:g,processData:!1,contentType:!1,success:function(a){i(e,a,b)},error:function(a){j(e,a,b)}}))}function i(a,b,c){d.uploadedCallback&&d.uploadedCallback(a,b,c),m+=1,m+n==l&&d.uploadFinished&&d.uploadFinished(m,n)}function j(a,b,c){d.uploadError&&d.uploadError(a,b,c),n+=1,m+n==l&&d.uploadFinished&&d.uploadFinished(m,n)}d=d||{},d.name=d.name||"file",d.accept=d.accept||"image/*",d.max=d.max||1;var l=0,m=0,n=0,o=a(b);if(!o.children(".webupload_container").size()){var p=d.max>1?" multiple ":"",q=o.css("position");"absolute"!=q&&"relative"!=q&&o.css("position","relative");var r=o.css("padding-top"),s=o.css("padding-left"),t=o.width(),u=o.height(),v='<div style="position: absolute; top: '+r+"; left: "+s+"; width: "+t+"px; height: "+u+'px; overflow: hidden; bottom: auto; right: auto;" class="webupload_container"><input type="file" style="position:absolute;clip:rect(1px,1px,1px,1px);" accept="'+d.accept+'"'+p+'><label style="opacity: 0; width: 100%; height: 100%; display: block; cursor: pointer; background: rgb(255, 255, 255);"></label></div>';o.append(v);var w=o.children(".webupload_container").find("input"),x=o.children(".webupload_container").find("label");x.on("click",function(){w.trigger("click")}),w.on("change",function(){if(this.files.length){for(var a=[],b=0,c=this.files.length;b<c;++b)a.push(this.files[b]);e(a)}})}return o}}(window.$||window.jQuery||window.Zepto);